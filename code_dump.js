

show ======= ======= =======
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:124 -- showPhoto
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:759 getThumbnailPhoto
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:760   whichThumbnail: 3
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:770 *** ajax success T ***
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:771 Array[4]

application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:140 showSelectedPhoto
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:214 makeCategoryDisplay
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:214 makeCategoryDisplay
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:214 makeCategoryDisplay
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:189 Array[13]
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:665 activateCategoryLinks
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:666   mode: show
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:667   $('#photo-grid'): [object Object]
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:668   $('.cat-select'): [object Object]
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:257 toggleSidebarInfo
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:264   photoInfo[0].title: Fishing cat
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:328 toggleSidebarEdit

edit ======= ======= =======
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:354 -- editSavePhoto
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:328 toggleSidebarEdit
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:376 editCurrentPhoto

application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:377 Display
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:140 showSelectedPhoto
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:214 makeCategoryDisplay
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:214 makeCategoryDisplay
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:214 makeCategoryDisplay
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:189 Array[13]
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:285 displayEditForm
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:286   this.currentPhoto.id: 3
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:665 activateCategoryLinks
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:666   mode: edit
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:667   $('#photo-grid'): [object Object]
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:668   $('.cat-select'): [object Object]

new ======= ======= ======= 
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:565 -- addPhoto
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:328 toggleSidebarEdit
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:368 addNewPhoto

application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:369 Display
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:140 showSelectedPhoto
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:214 makeCategoryDisplay
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:214 makeCategoryDisplay
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:214 makeCategoryDisplay
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:189 Array[13]
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:308 displayNewForm
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:665 activateCategoryLinks
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:666   mode: addNewPhoto
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:667   $('#photo-grid'): [object Object]
application.self-68f2f708881f5e61944e5c9bda6523c40bd92b6d65733588c04323cc8e8fda70.js?body=1:668   $('.cat-select'): [object Object]


Parameters: {
    "utf8"=>"✓",
    "photo"=>{
        "source"=>"https://upload.wikimedia.org/wikipedia/commons/3/3a/Geoffrey'sCat2.jpg",
        "title"=>"Geoffrey's Cat",
        "loc_taken"=>"Argentina",
        "date_taken"=>"1/2/33",
        "wt_ht"=>"3062 × 4328",
        "rating"=>"5",
        "caption"=>"Geoffrey's Cat",
        "photo_id"=>"",
        "genre"=>{"studio"=>["0"], "amateur"=>["0"], "professional"=>["0"]},
        "group"=>{"London"=>["0"], "House"=>["0"], "AlleyCatHouse"=>["0"]},
        "tag"=>{"travel"=>["0"], "friends"=>["0"], "nature"=>["0"], "house"=>["0"], "music"=>["0"], "events"=>["0"], "art_tech"=>["0"]}
    },
    "commit"=>"submit",
    "user_id"=>"1"}


// ======= ======= ======= submitPhotoInfo ======= ======= =======
Menu.prototype.submitPhotoInfo = function() {
    console.log("submitPhotoInfo");

    var self = this;
    var url = "http://localhost:3000/updatePhoto/";
    // var formValues = $('form').serialize();
    var formValues = $("form").serializeArray();
    // var formValues = JSON.stringify(jQuery('form').serializeArray());
    console.log("  formValues: " + formValues);
    $.ajax({
        url: url,
        type: "PATCH",
        data: formValues,
        dataType: "html"
    }).success(function(jsonData){
        console.log("*** ajax success T ***");
        console.dir(jsonData);
    });
}




    <a data-no-turbolink="true" href='javascript:void(0)' class="nav-link" id="photos">photos</a>

def update_join_tables(whichCategory, whichCategoryItems, whichPhoto)
    whichCategoryItems.each do |category|
        nextName = category.name
        nextObject = params[nextName]
        nextChecked = nextObject["checked"]
        if nextChecked == "on"
            if whichCategory == "genre"
                whichCategory_checked = PhotoGenre.where(photo_id: whichPhoto.id, genre_id: genre.id)
            elsif whichCategory == "group"
                whichCategory_checked = PhotoGroup.where(photo_id: whichPhoto.id, group_id: group.id)
            elsif whichCategory == "tag"
                whichCategory_checked = PhotoTag.where(photo_id: whichPhoto.id, tag_id: tag.id)
            end
            if whichCategory_checked.length == 0
                if whichCategory == "genre"
                    newCategory = PhotoGenre.new(:photo_id => whichPhoto.id, :genre_id => genre.id)
                elsif whichCategory == "group"
                    newCategory = PhotoGroup.new(:photo_id => whichPhoto.id, :group_id => group.id)
                elsif whichCategory == "tag"
                    newCategory = PhotoTag.new(:photo_id => whichPhoto.id, :tag_id => tag.id)
                end
                newCategory.save
            end
        else
            if whichCategory == "genre"
                remove_whichCategory = PhotoGenre.where(photo_id: whichPhoto.id, genre_id: genre.id)
            elsif whichCategory == "group"
                remove_whichCategory = PhotoGroup.where(photo_id: whichPhoto.id, group_id: group.id)
            elsif whichCategory == "tag"
                remove_whichCategory = PhotoTag.where(photo_id: whichPhoto.id, tag_id: tag.id)
            end
            if remove_whichCategory.length > 0
                remove_whichCategory.each do |remove_category|
                    remove_category.destroy
                end
            end
        end
    end
end




def update
    puts "******* updatePhoto " + "*" * 21
    @mode = "updatePhoto"
    gon.mode = @mode
    show_mode
    puts "     ** params " + params.to_s

    @photo = @current_user.photos.find(params[:id])
    genres = Genre.all

    # photo.photo_genres
    # genre.photo_genres

    genres.each do |genre|
        nextName = genre.name
        nextObject = params[nextName]
        nextChecked = nextObject["checked"]
        puts "     ** params[nextName] " + params[nextName].to_s
        puts "     ** nextObject " + nextObject.to_s
        puts "     ** nextChecked " + nextChecked.to_s
        if nextChecked == "on"
            genres_checked = PhotoGenre.where(photo_id: @photo.id, genre_id: genre.id)
            puts "     ** genres_checked " + genres_checked.to_s
            puts "     ** genres_checked.length " + genres_checked.length.to_s
            if genres_checked.length == 0
                newCategory = PhotoGenre.new(:photo_id => @photo.id, :genre_id => genre.id)
                newCategory.save
            end
            genres_checked = PhotoGenre.where(photo_id: @photo.id, genre_id: genre.id)
            puts "     ** genres_checked2 " + genres_checked.to_s
            puts "     ** genres_checked2.length " + genres_checked.length.to_s
        else
            remove_genres = PhotoGenre.where(photo_id: @photo.id, genre_id: genre.id)
            puts "     ** remove_genres " + remove_genres.to_s
            if remove_genres.length > 0
                remove_genres.each do |remove_genre|
                    remove_genre.destroy
                end
            end
        end
    end



{
"studio"=>{"name"=>"studio", "checked"=>"on", "category"=>"genre"},
"amateur"=>{"name"=>"amateur", "checked"=>"off", "category"=>"genre"},
"professional"=>{"name"=>"professional", "checked"=>"off", "category"=>"genre"},
"London"=>{"name"=>"London", "checked"=>"off", "category"=>"group"},
"House"=>{"name"=>"House", "checked"=>"off", "category"=>"group"},
"AlleyCatHouse"=>{"name"=>"AlleyCatHouse", "checked"=>"off", "category"=>"group"},
"travel"=>{"name"=>"travel", "checked"=>"off", "category"=>"tag"},
"friends"=>{"name"=>"friends", "checked"=>"off", "category"=>"tag"},
"nature"=>{"name"=>"nature", "checked"=>"off", "category"=>"tag"},
"house"=>{"name"=>"house", "checked"=>"off", "category"=>"tag"},
"music"=>{"name"=>"music", "checked"=>"off", "category"=>"tag"},
"events"=>{"name"=>"events", "checked"=>"off", "category"=>"tag"},
"art_tech"=>{"name"=>"art_tech", "checked"=>"on", "category"=>"tag"},

"photoData"=>{
    "source"=>"http://www.mountainphotography.com/images/large/JackBrauer_plitvickaJezera.jpg",
    "title"=>"big waterfall",
    "loc_taken"=>"tropics",
    "date_taken"=>"4/5/67",
    "wt_ht"=>"1600 × 1067",
    "rating"=>"3",
    "caption"=>"another waterfall"
},

"id"=>"7"
}


{ caption: "another waterfall"
date_taken: "4/5/67"
loc_taken: "tropics"
rating: "3"
source: "http://www.mountainphotography.com/images/large/JackBrauer_plitvickaJezera.jpg"
title: "big waterfall"
wt_ht: "1600 × 1067" }



{ product: { name: "Filip",
description: "whatever" } }

jsonDataString:
{"name":"studio","checked":"on","category":"genre"},
{"name":"amateur","checked":"off","category":"genre"},
{"name":"professional","checked":"off","category":"genre"},
{"name":"London","checked":"on","category":"group"},
{"name":"House","checked":"off","category":"group"},
{"name":"AlleyCatHouse","checked":"off","category":"group"},
{"name":"travel","checked":"on","category":"tag"},
{"name":"friends","checked":"off","category":"tag"},
{"name":"nature","checked":"off","category":"tag"},
{"name":"house","checked":"off","category":"tag"},
{"name":"music","checked":"off","category":"tag"},
{"name":"events","checked":"off","category":"tag"},
{"name":"art_tech","checked":"on","category":"tag"},

 {"source":"http://www.mountainphotography.com/images/large/JackBrauer_plitvickaJezera.jpg","title":"big waterfall","loc_taken":"tropics","date_taken":"4/5/67","wt_ht":"1600 × 1067","rating":"3","caption":"another waterfall"},

 {"{\"name\":\"studio\",\"checked\":\"on\",\"category\":\"genre\"},
 {\"name\":\"amateur\",\"checked\":\"off\",\"category\":\"genre\"},
 {\"name\":\"professional\",\"checked\":\"off\",\"category\":\"genre\"},
 {\"name\":\"London\",\"checked\":\"on\",\"category\":\"group\"},
 {\"name\":\"House\",\"checked\":\"off\",\"category\":\"group\"},
 {\"name\":\"AlleyCatHouse\",\"checked\":\"off\",\"category\":\"group\"},
 {\"name\":\"travel\",\"checked\":\"on\",\"category\":\"tag\"},
 {\"name\":\"friends\",\"checked\":\"off\",\"category\":\"tag\"},
 {\"name\":\"nature\",\"checked\":\"off\",\"category\":\"tag\"},
  {\"name\":\"house\",\"checked\":\"off\",\"category\":\"tag\"},
   {\"name\":\"music\",\"checked\":\"off\",\"category\":\"tag\"},
   {\"name\":\"events\",\"checked\":\"off\",\"category\":\"tag\"},
   {\"name\":\"art_tech\",\"checked\":\"on\",\"category\":\"tag\"}, {\"source\":\"http://www.mountainphotography.com/images/large/JackBrauer_plitvickaJezera.jpg\",
   \"title\":\"big waterfall\",
   \"loc_taken\":\"tropics\",
   \"date_taken\":\"4/5/67\",
   \"wt_ht\":\"1600 × 1067\",
   \"rating\":\"3\",
   \"caption\":\"another waterfall\"}, "=>nil, "id"=>"7"}

jsonDataArray:
{"name":"studio","checked":"on","category":"genre"},
{"name":"amateur","checked":"off","category":"genre"},
{"name":"professional","checked":"off","category":"genre"},
{"name":"London","checked":"on","category":"group"},
{"name":"House","checked":"off","category":"group"},
{"name":"AlleyCatHouse","checked":"off","category":"group"},
{"name":"travel","checked":"on","category":"tag"},
{"name":"friends","checked":"off","category":"tag"},
{"name":"nature","checked":"off","category":"tag"},
{"name":"house","checked":"off","category":"tag"},
{"name":"music","checked":"off","category":"tag"},
{"name":"events","checked":"off","category":"tag"},
{"name":"art_tech","checked":"off","category":"tag"},
{"source":"http://www.mountainphotography.com/images/large/JackBrauer_plitvickaJezera.jpg",
"title":"big waterfall",
"loc_taken":"tropics",
"date_taken":"4/5/67",
"wt_ht":"1600 × 1067",
"rating":"3",
"caption":"another waterfall"}


photoDataJson: [
    {"name":"source","value":"http://www.mountainphotography.com/images/large/JackBrauer_plitvickaJezera.jpg"},
    {"name":"title","value":"big waterfall"},
    {"name":"loc_taken","value":"tropics"},
    {"name":"date_taken","value":"4/5/67"},
    {"name":"wt_ht","value":"1600 × 1067"},
    {"name":"rating","value":"3"},
    {"name":"caption","value":"another waterfall"},
    {"name":"studio","checked":"on","category":"genre"},
    {"name":"amateur","checked":"off","category":"genre"},
    {"name":"professional","checked":"off","category":"genre"},
    {"name":"London","checked":"on","category":"group"},
    {"name":"House","checked":"off","category":"group"},
    {"name":"AlleyCatHouse","checked":"off","category":"group"},
    {"name":"travel","checked":"on","category":"tag"},
    {"name":"friends","checked":"off","category":"tag"},
    {"name":"nature","checked":"off","category":"tag"},
    {"name":"house","checked":"off","category":"tag"},
    {"name":"music","checked":"off","category":"tag"},
    {"name":"events","checked":"off","category":"tag"},
    {"name":"art_tech","checked":"off","category":"tag"}
]


selectionJson: [[
    {"name":"studio","checked":"checked","category":"genre"},
    {"name":"amateur","checked":"","category":"genre"},
    {"name":"professional","checked":"","category":"genre"},
    {"name":"London","checked":"checked","category":"group"},
    {"name":"House","checked":"","category":"group"},
    {"name":"AlleyCatHouse","checked":"","category":"group"},
    {"name":"travel","checked":"checked","category":"tag"},
    {"name":"friends","checked":"","category":"tag"},
    {"name":"nature","checked":"","category":"tag"},
    {"name":"house","checked":"","category":"tag"},
    {"name":"music","checked":"","category":"tag"},
    {"name":"events","checked":"","category":"tag"},
    {"name":"art_tech","checked":"","category":"tag"}],

    [{"name":"source","value":"http://www.mountainphotography.com/images/large/JackBrauer_plitvickaJezera.jpg"},
    {"name":"title","value":"big waterfall"},
    {"name":"loc_taken","value":"tropics"},
    {"name":"date_taken","value":"4/5/67"},
    {"name":"wt_ht","value":"1600 × 1067"},
    {"name":"rating","value":"3"},
    {"name":"caption","value":"another waterfall"}]]


        // ======= get all user photos =======
        $(".tag-edits").on("click", ".cat-select", function(){
            console.log("-- selectCat");
            menuObject.toggleCategoryTag(event.target.id);
        });
